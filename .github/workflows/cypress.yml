name: Run Cypress Tests

on:
  push:

jobs:
  docker:
    timeout-minutes: 15
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v1

    - name: Cypress run  
      uses: cypress-io/github-action@v4.2.0
      with:
        # in theory the container should shut down automatically
        start: docker-compose up
        working-directory: cypress
        browser: chrome
        record: true
        wait-on: 'http://localhost:3000'
        wait-on-timeout: 300
        spec: e2e/!(07_EyesOn_Check).{js,jsx,ts,tsx}
      env:
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # https://github.com/cypress-io/github-action#debugging
          # DEBUG: '@cypress/github-action'
          DEBUG: 'cypress:*'

    # - name: Stop Empirica
    #   if: always()
    #   run: docker-compose -f "docker-compose-dev.yml" down
